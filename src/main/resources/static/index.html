<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>树洞 - 倾诉你的心声</title>
    <link rel="stylesheet" href="/css/style.css?v=33">
    <!-- 引入 Remix Icon (更换为国内 Staticfile 源) -->
    <link href="https://cdn.staticfile.net/remixicon/4.1.0/remixicon.css" rel="stylesheet">
    <!-- 引入 Flatpickr (优雅的日期选择器) -->
    <link href="https://cdn.staticfile.net/flatpickr/4.6.13/flatpickr.min.css" rel="stylesheet">
    <link href="https://cdn.staticfile.net/flatpickr/4.6.13/themes/material_green.min.css" rel="stylesheet">
</head>
<body>
    <!-- 导航栏 -->
    <nav class="navbar animate-slide-down">
        <div class="logo">
            <i class="ri-tree-line" style="font-size: 24px; color: var(--primary-color);"></i>
            <span>树洞 TreeHole</span>
        </div>
        
        <div class="nav-right" style="display: flex; align-items: center; gap: 15px;">
            <!-- AI树洞 -->
            <div class="nav-icon-btn" onclick="window.location.href='ai_chat.html'" title="AI树洞">
                <i class="ri-robot-2-line"></i>
            </div>

            <!-- 真正匿名树洞 -->
            <div class="nav-icon-btn" onclick="window.location.href='anonymous.html'" title="匿名树洞">
                <i class="ri-spy-line"></i>
            </div>

            <!-- 时光胶囊 -->
            <div class="nav-icon-btn" onclick="showTimeCapsuleModal()" title="时光胶囊">
                <i class="ri-capsule-line"></i>
            </div>

            <!-- 通知铃铛 (移动到这里) -->
            <div class="nav-icon-btn" onclick="showNotificationModal()" title="通知">
                <i class="ri-notification-3-line"></i>
            </div>

            <!-- 树洞切换 (分类筛选) -->
            <select id="hole-category" class="nav-select" onchange="onCategoryChange()">
                <option value="all">🌲 全部</option>
                <option value="day">☀️ 白日</option>
                <option value="night">🌙 黑夜</option>
                <option value="happy">😄 开心</option>
                <option value="unhappy">😞 不开心</option>
            </select>

            <!-- 发布按钮 (笔图标) -->
            <div class="nav-icon-btn" onclick="showPublishModal()" title="发布树洞">
                <i class="ri-edit-2-line"></i>
            </div>

            <div class="user-info" id="user-status">
                <!-- 登录状态将在这里动态渲染 -->
                <span>想看更多？</span>
                <a href="login.html" class="btn-link">去登录/注册</a>
            </div>
        </div>
    </nav>

    <div class="main-container animate-fade-in">
        <!-- 顶部组合看板 (Dashboard Group) -->
        <div class="dashboard-group">
            <!-- 轮播图区域 -->
            <div class="carousel-section">
                <div class="carousel-container">
                    <div class="carousel-wrapper" id="carousel-wrapper">
                        <div class="carousel-slide"><img src="/picture/p1.png" alt="Banner 1"></div>
                        <div class="carousel-slide"><img src="/picture/p2.png" alt="Banner 2"></div>
                        <div class="carousel-slide"><img src="/picture/p3.png" alt="Banner 3"></div>
                        <div class="carousel-slide"><img src="/picture/p4.png" alt="Banner 4"></div>
                        <div class="carousel-slide"><img src="/picture/p5.png" alt="Banner 5"></div>
                        <div class="carousel-slide"><img src="/picture/p6.png" alt="Banner 6"></div>
                    </div>
                    <div class="carousel-dots" id="carousel-dots"></div>
                    <!-- 覆盖水印的宗旨徽章 -->
                    <div class="carousel-badge">
                        <i class="ri-shield-check-fill"></i> 我们的宗旨：温暖每一个孤独的灵魂
                    </div>
                </div>
            </div>
            
            <!-- Top 10 区域 -->
            <div class="top10-section">
                <div class="top-10-wrapper">
                    <h3 class="top10-header"><i class="ri-fire-line" style="color: #ff7675;"></i> 热门树洞 Top 10</h3>
                    <ul id="top-10-list" class="top-10-list">
                        <!-- 动态加载 -->
                        <li class="loading-item">加载中...</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- 树洞内容区域 (两栏布局) -->
        <div class="feed-layout-wrapper">
            <!-- 左侧：树洞列表 (GitCode 卡片样式) -->
            <div class="feed-main-column">
                <div id="feed-container">
                    <!-- 动态加载内容 -->
                </div>
                
                <!-- 加载更多按钮 -->
                <div class="load-more-container">
                    <button id="load-more-btn" class="btn-load-more" onclick="loadHoles(false)" style="display: none;">加载更多</button>
                </div>
            </div>

            <!-- 右侧：预留拓展区域 -->
            <div class="feed-sidebar-column">
                <div class="sidebar-card top-users-card">
                    <div class="card-header" style="padding-bottom: 10px; border-bottom: 1px solid #f0f0f0; margin-bottom: 10px;">
                        <h3 style="font-size: 16px; margin: 0; display: flex; align-items: center; gap: 8px;">
                            <i class="ri-trophy-line" style="color: #ff9f43;"></i> Top10洞主
                        </h3>
                    </div>
                    <div id="top-users-list" class="top-users-list">
                        <div style="text-align: center; color: #999; padding: 20px;">加载中...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 通知弹窗 -->
    <div id="notification-modal" class="modal-overlay" onclick="if(event.target === this) closeNotificationModal()">
        <div class="modal-content glass-effect">
            <div class="modal-header">
                <!-- 顶部切换 -->
                <div class="notif-tabs">
                    <button id="notif-tab-letters" class="notif-tab active" onclick="switchNotificationTab('letters')">
                        <i class="ri-mail-line"></i> 树洞来信
                    </button>
                    <button id="notif-tab-capsules" class="notif-tab" onclick="switchNotificationTab('capsules')">
                        <i class="ri-capsule-fill"></i> 胶囊解封
                    </button>
                </div>
                <span class="close-btn" onclick="closeNotificationModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="notif-letters-list" class="notification-list">
                    <!-- 动态加载 -->
                </div>
                <div id="notif-capsules-list" class="notification-list" style="display: none;">
                    <!-- 动态加载 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 用户中心弹窗 -->
    <div id="user-center-modal" class="modal-overlay" onclick="if(event.target === this) closeUserCenter()">
        <div class="modal-content glass-effect">
            <div class="modal-header">
                <h3>个人中心</h3>
                <span class="close-btn" onclick="closeUserCenter()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="uc-info-section">
                    <div class="uc-avatar-wrapper" onclick="document.getElementById('avatar-input').click()">
                        <img id="uc-avatar-img" src="" alt="头像">
                        <div id="uc-avatar-default" class="avatar-default"><i class="ri-user-line"></i></div>
                        <div class="avatar-edit-hint"><i class="ri-camera-line"></i></div>
                        <input type="file" id="avatar-input" accept="image/*" style="display: none;" onchange="previewAvatar(this)">
                    </div>
                    <div class="uc-text-info">
                        <div class="uc-username" id="uc-username">@username</div>
                        <input type="text" id="uc-nickname-input" class="uc-input" placeholder="设置昵称">
                    </div>
                </div>
                
                <div class="uc-actions">
                    <button class="btn-primary" onclick="saveUserInfo()">保存修改</button>
                    <button class="btn-outline" onclick="toggleChangePassword()">修改密码</button>
                    <button class="btn-danger" onclick="logout()">退出登录</button>
                </div>
                
                <!-- 修改密码区域 -->
                <div id="password-change-area" class="password-area" style="display: none;">
                    <input type="password" id="old-password" class="uc-input" placeholder="旧密码">
                    <input type="password" id="new-password" class="uc-input" placeholder="新密码 (6-20位)">
                    <button class="btn-primary" onclick="submitChangePassword()" style="margin-top: 10px; width: 100%;">确认修改</button>
                </div>

                <div class="uc-divider"></div>
                
                <div class="uc-my-holes">
                    <div class="uc-tabs">
                        <button id="tab-my-holes" class="uc-tab active" onclick="switchUcTab('my-holes')">我的发布</button>
                        <button id="tab-my-favorites" class="uc-tab" onclick="switchUcTab('my-favorites')">我的收藏</button>
                        <button id="tab-my-follows" class="uc-tab" onclick="switchUcTab('my-follows')">我的关注</button>
                        <button id="tab-my-fans" class="uc-tab" onclick="switchUcTab('my-fans')">我的粉丝</button>
                    </div>
                    <div id="my-holes-list" class="my-holes-list">
                        <!-- 我的树洞列表 -->
                    </div>
                    <div id="my-favorites-list" class="my-holes-list" style="display: none;">
                        <!-- 我的收藏列表 -->
                    </div>
                    <div id="my-follows-list" class="my-holes-list" style="display: none;">
                        <!-- 我的关注列表 -->
                    </div>
                    <div id="my-fans-list" class="my-holes-list" style="display: none;">
                        <!-- 我的粉丝列表 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 用户卡片弹窗挂载点 -->
    <div id="user-card-overlay" class="user-card-overlay" onclick="closeUserCard()"></div>
    <div id="user-card-popup" class="user-card-popup">
        <!-- 内容动态生成 -->
    </div>

    <!-- 发布树洞弹窗 -->
    <div id="publish-modal" class="modal-overlay" onclick="if(event.target === this) closePublishModal()">
        <div class="modal-content glass-effect" style="max-width: 600px;">
            <div class="modal-header">
                <h3>发布树洞</h3>
                <span class="close-btn" onclick="closePublishModal()">&times;</span>
            </div>
            <div class="modal-body">
                <textarea id="hole-content" class="publish-textarea" placeholder="这里是树洞，在这里写下你的心事..."></textarea>
                <div class="publish-tools" style="margin-top: 20px;">
                    <select id="publish-category" class="category-select">
                        <option value="day">☀️ 白日树洞</option>
                        <option value="night">🌙 黑夜树洞</option>
                        <option value="happy">😄 开心树洞</option>
                        <option value="unhappy">😞 不开心树洞</option>
                    </select>
                    <button class="btn-submit" onclick="publishHole()">发布</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 时空胶囊弹窗 -->
    <div id="capsule-modal" class="modal-overlay" onclick="if(event.target === this) closeTimeCapsuleModal()">
        <div class="modal-content glass-effect" style="max-width: 500px; border-radius: 24px; padding: 0; overflow: hidden;">
            <div class="modal-header" style="border: none; padding: 20px 24px 0;">
                <h3 style="display: flex; align-items: center; gap: 8px;">
                    <i class="ri-capsule-fill" style="color: var(--primary-color);"></i>
                    时空胶囊
                </h3>
                <span class="close-btn" onclick="closeTimeCapsuleModal()">&times;</span>
            </div>
            <div class="modal-body" style="padding: 24px;">
                <!-- 顶部切换 -->
                <div class="capsule-tabs">
                    <button class="capsule-tab active" onclick="switchCapsuleTab('bury')">
                        <i class="ri-edit-circle-line"></i> 埋下胶囊
                    </button>
                    <button class="capsule-tab" onclick="switchCapsuleTab('list')">
                        <i class="ri-file-list-line"></i> 我的胶囊
                    </button>
                </div>

                <!-- 埋藏胶囊界面 -->
                <div id="capsule-bury-view">
                    <div class="letter-paper">
                        <textarea id="capsule-content" class="letter-textarea" placeholder="写给未来的自己，或者埋藏一个不想现在公开的秘密..."></textarea>
                    </div>
                    <div class="capsule-settings">
                        <div class="setting-item">
                            <i class="ri-calendar-event-line"></i>
                            <label>开启时间</label>
                            <input type="text" id="capsule-time" class="capsule-input" placeholder="选择未来的某个时刻..." readonly>
                        </div>
                    </div>
                    <button id="btn-bury-capsule" class="btn-submit" style="width: 100%; margin-top: 20px; height: 44px; font-size: 16px; display: flex; align-items: center; justify-content: center; gap: 8px;" onclick="buryCapsule()">
                        <i class="ri-send-plane-fill"></i> 埋下胶囊
                    </button>
                </div>

                <!-- 胶囊列表界面 -->
                <div id="capsule-list-view" style="display: none;">
                    <div id="capsule-list-container" class="capsule-list">
                        <!-- 动态加载 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 查看用户树洞弹窗 (通知点击头像后) -->
    <div id="target-user-holes-modal" class="modal-overlay" onclick="if(event.target === this) closeTargetUserHoles()">
        <div class="modal-content glass-effect" style="width: 500px; max-height: 80vh;">
            <div class="modal-header">
                <h3 id="target-user-holes-title">TA的树洞</h3>
                <span class="close-btn" onclick="closeTargetUserHoles()">&times;</span>
            </div>
            <div class="modal-body" style="padding: 0;">
                <div id="target-user-holes-list" class="my-holes-list" style="padding: 20px;">
                    <!-- 动态加载内容 -->
                </div>
            </div>
        </div>
    </div>

    <script src="/js/script.js?v=30"></script>
    <script src="https://cdn.staticfile.net/flatpickr/4.6.13/flatpickr.min.js"></script>
    <script src="https://cdn.staticfile.net/flatpickr/4.6.13/l10n/zh.min.js"></script>
</body>
</html>
